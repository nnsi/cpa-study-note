# 問題画像→論点チェック機能 タスクリスト

## Phase 1: 基盤

### DB・スキーマ
- [ ] Exercise テーブルのDrizzleスキーマ作成
- [ ] マイグレーション生成・適用

### 画像アップロード
- [ ] R2バケット設定確認
- [ ] 画像アップロードAPI（`POST /images/upload`）
- [ ] 画像URL取得API（署名付きURL）

### OCR
- [ ] OCR用AIモデル選定・設定（OpenRouter経由）
- [ ] OCRプロンプト作成
- [ ] OCR呼び出しユーティリティ実装

## Phase 2: 論点推測

### API
- [ ] `POST /exercises/analyze` エンドポイント作成
  - [ ] 画像受け取り → R2保存
  - [ ] OCR呼び出し
  - [ ] 論点推測AI呼び出し
  - [ ] レスポンス整形

### 論点推測AI
- [ ] 論点リスト取得ロジック
- [ ] 論点推測プロンプト作成・調整
- [ ] confidence / reason の出力パース

### フロントエンド
- [ ] 画像アップロード画面
- [ ] 論点提案画面
  - [ ] 提案リスト表示
  - [ ] 「別の論点を選ぶ」検索UI
  - [ ] 「理解した」チェックボックス

## Phase 3: 確定・保存

### API
- [ ] `POST /exercises/:id/confirm` エンドポイント作成
  - [ ] 論点紐づけ保存
  - [ ] TopicCheck連携（任意）
- [ ] `GET /topics/:id/exercises` エンドポイント作成

### フロントエンド
- [ ] 確定後の完了画面
- [ ] 論点詳細画面に「問題」タブ追加
- [ ] 問題一覧表示コンポーネント

## Phase 4: 検証・調整

### 動作確認
- [ ] curl でAPI動作確認
- [ ] ブラウザでE2E確認（アップロード→提案→確定→一覧表示）
- [ ] 実際の問題画像でOCR精度確認
- [ ] 論点推測の精度確認・プロンプト調整

### エッジケース
- [ ] OCR失敗時のエラーハンドリング
- [ ] 論点推測失敗時のフォールバック（手動選択のみ）
- [ ] 大きな画像ファイルの処理

## 将来タスク（スコープ外）

- [ ] 問題から直接チャット開始機能
- [ ] 同論点の問題を並べて復習機能
- [ ] 問題の難易度自己評価
