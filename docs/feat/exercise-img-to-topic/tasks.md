# 問題画像→論点チェック機能 タスクリスト

## Phase 1: 基盤

### DB・スキーマ
- [x] Exercise テーブルのDrizzleスキーマ作成
- [x] マイグレーション生成・適用

### 画像アップロード
- [x] R2バケット設定確認
- [x] 画像アップロードAPI（`POST /images/upload`）
- [x] 画像URL取得API（署名付きURL）

### OCR
- [x] OCR用AIモデル選定・設定（OpenRouter経由）
- [x] OCRプロンプト作成
- [x] OCR呼び出しユーティリティ実装

## Phase 2: 論点推測

### API
- [x] `POST /exercises/analyze` エンドポイント作成
  - [x] 画像受け取り → R2保存
  - [x] OCR呼び出し
  - [x] 論点推測AI呼び出し
  - [x] レスポンス整形

### 論点推測AI
- [x] 論点リスト取得ロジック
- [x] 論点推測プロンプト作成・調整
- [x] confidence / reason の出力パース

### フロントエンド
- [x] 画像アップロード画面
- [x] 論点提案画面
  - [x] 提案リスト表示
  - [x] 「別の論点を選ぶ」検索UI
  - [x] 「理解した」チェックボックス

## Phase 3: 確定・保存

### API
- [x] `POST /exercises/:id/confirm` エンドポイント作成
  - [x] 論点紐づけ保存
  - [ ] TopicCheck連携（任意）
- [x] `GET /topics/:id/exercises` エンドポイント作成

### フロントエンド
- [x] 確定後の完了画面
- [x] 論点詳細画面に「問題」タブ追加
- [x] 問題一覧表示コンポーネント

## Phase 4: 検証・調整

### 動作確認
- [x] curl でAPI動作確認
- [x] ブラウザでE2E確認（アップロード→提案→確定→一覧表示）
- [ ] 実際の問題画像でOCR精度確認
- [ ] 論点推測の精度確認・プロンプト調整

### エッジケース
- [x] OCR失敗時のエラーハンドリング
- [x] 論点推測失敗時のフォールバック（手動選択のみ）
- [x] 大きな画像ファイルの処理

### テスト
- [x] ExerciseRepository ユニットテスト（12テスト）
- [x] API型チェック（tsc --noEmit）通過
- [x] フロントエンド型チェック通過

## 将来タスク（スコープ外）

- [ ] 問題から直接チャット開始機能
- [ ] 同論点の問題を並べて復習機能
- [ ] 問題の難易度自己評価
