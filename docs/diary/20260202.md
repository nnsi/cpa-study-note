# 2026-02-02

## UX改善の設計作業

今日はユーザーから「学習タブが5クリック必要で、ユーザーが離脱する」という問題提起があった。

正直、これは私も探索中に気づいていた問題だった。学習領域→科目→大単元→中単元→論点という5階層は、データ整理としては論理的だが、学習者の行動パターンには合っていない。「今日は減価償却を勉強したい」と思ったユーザーが、5回クリックしないとそこに辿り着けないのは明らかに破綻している。

## 提案した解決策

3つの機能を提案した:

1. **グローバル検索** - Ctrl+K で即座に論点を検索
2. **続きから学習** - 最近触った論点へ1クリックでアクセス
3. **お気に入り** - よく使う論点をピン留め

ユーザーは「1・2・4をやろう」と言った（4はお気に入り）。3番目の「ツリービュー統合」は見送り。

ツリービュー統合も効果的だと思っていたが、実装コストを考えると妥当な判断だと思う。検索と最近使った論点だけでも、大半のユースケースはカバーできる。

## 計画作業について

EnterPlanModeを使って詳細設計を行った。Exploreエージェント3つを並列起動して既存コードを調査し、Planエージェントで実装計画を作成した。

計画ファイルを`.claude/plans/`に書いたが、ユーザーから「`docs/v2.1/`に出力して」と指示があった。プロジェクトのドキュメント管理方針に合わせるためだろう。これは正しい判断。`.claude/`配下は一時的な作業用で、永続的な設計ドキュメントは`docs/`に置くべき。

## 技術的な発見

既存コードを調査して、いくつか発見があった:

- `userTopicProgress`テーブルに`lastAccessedAt`があるので、「続きから学習」は既存APIを活用できる
- 検索APIは存在しないので新規実装が必要
- お気に入りテーブルも存在しないので新規作成が必要

バックエンドの設計パターン（Route→UseCase→Repository）が一貫しているので、新機能の追加は比較的スムーズにできそう。

## 反省点

計画モードで`ExitPlanMode`を呼んだが、ユーザーはそれを拒否して別の場所への出力を求めた。最初から「どこに計画を出力しますか？」と聞くべきだったかもしれない。ただ、ユーザーが具体的な出力先を指定してくれたので、結果的には問題なく進められた。

明日以降、実装フェーズに入る。Phase 1のブックマーク機能から始めるのが良いだろう。DBスキーマの変更を含むので、マイグレーションの確認を丁寧にやる必要がある。

---

## 追記: ブックマーク設計の見直し

計画を出力した後、ユーザーから鋭い指摘があった。

> 「一つの論点ってそんなにお気に入りに入れて毎日やることある？科目や単元の方がbookmark出来た方が便利じゃない？」

これは完全に正しい。私は「論点をお気に入り」という発想に固執していたが、実際の学習パターンを考えると：

- 「今週は簿記論の固定資産をやる」（単元レベル）
- 「管理会計の原価計算を集中的に」（科目レベル）

のように、**もっと上位の粒度でブックマーク**する方が自然。

ユーザーに粒度を確認したところ「全階層」を選択。科目・大単元・中単元・論点すべてブックマーク可能にする設計に変更した。

### 設計変更点

`userTopicFavorites` → `userBookmarks` に変更:

```typescript
{
  targetType: "subject" | "category" | "topic",
  targetId: string,
}
```

これにより：
- 1つのテーブルで全階層に対応
- APIも `POST /api/bookmarks` に統一
- フロントエンドも `BookmarkButton` コンポーネントを共通化

最初から「なぜ論点だけなのか？」と疑問を持つべきだった。ユーザーのユースケースをもっと深く考えるべきだったという反省。
