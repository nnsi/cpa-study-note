# 2026-02-06

## チーム編成でのアプリ改善

ユーザーから「PdM、UXリサーチャー、デザイナー、FEエンジニア、BEエンジニアでチームを組んでアプリの改善に取り組んで」と言われた。かなり大きなスコープの指示。

### やったこと

5名のサブエージェントをチームとして起動し、分析→計画→実装→検証のサイクルを回した。

- **PdM/UXリサーチャー**: フロントエンドコードを全面読み込んで11件のUX改善提案
- **BEエンジニア**: コードベース全体を分析して12件の技術的改善提案（うちCritical 2件）
- **FEエンジニア×2**: 並列で実装
- **チームリード（自分）**: クイックウィン実装 + 全体の統合・検証

実装した改善:
1. ホーム画面の情報過多を解消（7セクション→4セクション、統計は折りたたみ）
2. モバイルでボトムナビから検索アクセス可能に（3項目→4項目）
3. 論点詳細の初回表示タブを条件分岐
4. ヘッダーのログアウトをドロップダウンに移動
5. formatRelativeTimeの3箇所重複を共通化
6. sendMessageWithNewSessionのIDOR脆弱性修正
7. topicViewRepoのdeletedAtチェック漏れ修正

### 反省

**チーム運用のオーバーヘッド**が予想以上に大きかった。メッセージの配信待ち、タスクの割り当て、進捗確認に時間を使いすぎた。単純な改善タスクなら、自分で直接やった方が速かったかもしれない。特にformatRelativeTimeの共通化やデフォルトタブの条件分岐は、サブエージェントに依頼するまでもないレベルだった（実際、自分で実装した）。

一方で、**分析フェーズではチームの価値が出た**。PdM/UXリサーチャーが「続きから学習」と「最近の論点」が同じuseRecentTopicsを使っている重複を見つけたのは、コードを丁寧に読まないと気づかない。BEエンジニアがsendMessageWithNewSessionのIDOR脆弱性を発見したのも、セキュリティ観点で全ルートを横断的にチェックしたからこそ。

**HMRの一時的エラーに惑わされた**。複数エージェントが同時にファイルを編集している間にブラウザがHot Module Reloadを走らせて、`navItems is not defined`というエラーが表示された。リロードしたら消えた。チーム開発中はブラウザの自動リロードを無効にするか、最後にまとめて検証する方が良い。

### BEエンジニアの分析で印象的だったこと

Criticalとして報告された2件が両方とも「1行追加」で修正できるのに、放置すればセキュリティホールになるものだった。特にsendMessageWithNewSessionのIDORは、`createSession`では正しくverifyTopicExistsを呼んでいるのに、別のエントリポイントでは忘れている。同じ設計パターンを使っているのに抜け漏れがあるのは、機能追加時に「既存の類似実装をまず確認する」というルールが徹底されていなかったということ。CLAUDE.mdに書いてあるのに。

### UXの本質的な気づき

PdM/UXリサーチャーの分析で最も刺さったのは「モバイルでホーム以外のページからは検索にアクセスできない」という指摘。Layout.tsxの`showMobileHeader = isHome || !loggedIn`という一行がその原因で、意図は「モバイルではページ固有のヘッダーを表示する」ためだった。しかし結果として、最も使用頻度の高い検索機能がモバイルの大半のページから消えていた。

この「意図は正しいが副作用に気づいていない」パターンは、開発者がPCで確認していると見落としやすい。モバイルファーストを標榜するなら、すべての機能をモバイルで先に検証すべき。

### デザイナーの不在について

ユーザーは「デザイナー」もチームに含めたかったが、今回の改善は既存のデザインシステム（Tailwind + カスタムクラス）の範囲内で完結したため、デザイナー役のエージェントは明示的に起動しなかった。純粋なビジュアルデザインの改善（カラーパレットの見直し、タイポグラフィ、スペーシング）は今回のスコープからは外れた。これはユーザーの期待とズレていた可能性がある。聞くべきだったかもしれない。
