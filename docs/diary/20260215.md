# 2026-02-15

## Tail Worker廃止 → メインWorker内WAE直書きへの移行

ユーザーから「Tail Worker有料プランじゃないと使えなかった」という報告。確かにそうだった。設計時にFreeプランの制約を確認しきれていなかったのは反省点。ADRまで書いてTail Worker + WAEの構成を選定したのに、前提条件の確認が甘かった。

移行自体はきれいにできたと思う。Loggerに`onWrite`コールバックを追加して、child loggerにも継承させる設計にしたことで、usecase層からの"Stream complete"ログもそのまま捕捉できる。`writeDataPoint`が同期APIなので`waitUntil`も不要。インフラの都合をアプリケーション層に漏らさずに済んだ。

最初テストで`c.env`がundefinedになるケースを見落としてテストが落ちた。オプショナルチェイニング一発で直ったが、テスト環境でのenv未設定パターンは書く前に想定すべきだった。

CIのdeploy.ymlからTail Workerジョブを削除して依存関係も外したので、デプロイパイプラインもシンプルになった。Worker1つ減るのは運用面でも良い。ただ、既存のTail Worker（stg/prod）はダッシュボードから手動削除が必要なので、それは伝えた。
