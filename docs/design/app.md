# CPA Study Note（仮）思想・設計要件まとめ

## 0. 前提

- 本アプリは **学習補助ツール**であり、教材の代替を目的としない
- 「理解が進んだかどうか」の判断は行わず、記録・整理・可視化に徹する
- 既存の主学習（予備校テキスト/問題集/講義/過去問等）と併用される前提
- AI は主役ではなく、学習の痕跡を残すための道具として利用する

---

## 1. コア思想（不変）

### 1.1 判断しない
- アプリはユーザーの理解度・正誤・達成を評価しない
- ユーザーが「分かった」と思った時点で論点チェックを付ける（自己判断）

### 1.2 論点（Topic）中心
- すべての活動（チャット・ノート・画像・履歴）は論点に紐づく
- 論点は「地図」であり、学習の主導権はユーザーにある

### 1.3 痕跡を残す
- 何を聞き、どう理解し、どこで詰まったかを論点単位で残す
- 後から振り返れることを最優先する（復習の強さ）

### 1.4 価値は「気づきの材料」
- アプリは解釈を押し付けず、ユーザーが気づく材料（事実）を見せる

---

## 2. ドメイン（概念）モデル

### 2.1 基本エンティティ
- Subject（科目）
- Topic（論点）
- TopicCheck（ユーザーによる理解チェック）
- ChatSession（論点に紐づく対話セッション）
- ChatMessage（メッセージ）
- Note（論点ノート：対話から生成/編集される整理物）
- Attachment（画像/ファイル：問題画像等）
- MetricSnapshot（可視化用の集計スナップショット）

### 2.2 重要制約
- ChatSession は必ず Topic に紐づく
- Note は Topic に紐づく（Chat からの派生でも、独立編集でもよい）
- TopicCheck は「ユーザーの自己判断」であり、AI は関与しない

---

## 3. 機能要件（実装すべき機能）

## 3.1 論点マップ（Topic Browser）
- 科目一覧
- 科目→論点一覧（階層/タグ/フィルタ対応）
- 論点詳細画面（概要/ノート/チャット/履歴への導線）
- 論点の編集（管理者・または将来的にユーザー定義論点）

### 論点初期データ
- 公的な出題範囲資料等から初期投入（最初は粗くてよい）
- 後から分割/統合/補足可能であること

---

## 3.2 論点チェック（ユーザー自己判断）
- 論点ごとに「チェックON/OFF」
- チェックの履歴（いつONにしたか）
- チェック後の学習痕跡も残る（チェック＝終了ではない）

---

## 3.3 論点特化チャット（中核）
- 論点詳細画面内で対話できる
- セッション単位（開始/終了）で管理
- 履歴は論点に閉じる（汎用チャット画面を持たない）
- 会話ログは保存され、ノート化に利用される

---

## 3.4 ノート機能（学習痕跡の整理）
- 論点ごとにノートを作成・編集
- チャットログからノート案を生成
- ノートは「自分用に再構成」できる（編集の自由度）
- ノートは復習の起点として使える（論点へ戻る導線）

---

## 3.5 質問の質フィードバック（チェックマーク）
- 「理解度」ではなく「質問の性質」に対するフィードバック
- メッセージ単位でラベル付け
  - 例：✔（深掘り） / △（確認）
- ラベルの根拠は内部保持（UIに過度に出さない）
- ラベルはノート/振り返りに利用

---

## 3.6 振り返り・復習のための可視化（2軸）
### 軸A：自己判断の履歴
- 日ごとの「チェック済み論点数」の推移（折線）

### 軸B：思考行動の痕跡
- 日ごとのチャット活動量（セッション数、メッセージ数など）
- 日ごとの✔質問数（事実量）

### 目的
- 評価ではなく、後から「どの論点に時間がかかったか」を見つけやすくする

---

## 3.7 事実ベースの論点フィルタ（復習導線）
- 条件で論点を抽出できる
  - チャットセッションが x 件以上
  - 最終チャットから y 日経過
  - チェック済/未チェック
  - チェック後にチャットが発生している論点
  - ✔が付いた質問がn件以上
- 抽出結果から論点詳細へ戻れる

---

## 3.8 問題画像対応（OCR → 解法の分離）
### フロー
1) 画像アップロード（問題のスクショ等）
2) OCRモデルでテキスト化（数値・表構造をできるだけ保持）
3) 抽出テキストを保存（Attachment / ExtractedText）
4) DeepSeek-V3 に「テキスト問題」として渡して解法説明を生成
5) 生成結果を論点ノート/チャットに取り込む

### 目的
- 画像理解と推論を分離して安定性を高める
- DeepSeek-V3 はテキスト推論に集中させる

---

## 4. AI 構成（役割分担）

### 4.1 回答AI（DeepSeek-V3）
- 役割：論点内の説明・解法・深掘り対話
- 入力：論点コンテキスト + ユーザー質問 + 必要最小限の履歴/要約
- 出力：ユーザー向け回答

### 4.2 要約AI（別モデル/別呼び出し）
- 役割：ノート用要約、メッセージ分類（✔/△）、構造化ログ生成
- 入力：ユーザー質問 + 回答 + 論点ID
- 出力：ノート素材、質問タイプ、タグ

### 4.3 OCR AI（Vision/OCRモデル）
- 役割：画像→テキスト抽出（忠実さ重視）
- 出力は必ず構造化テキストとして保存し、推論モデルに渡す

---

## 5. データ・イベント（保存すべきもの）

- TopicCheck の変更履歴（いつチェックしたか）
- ChatSession / ChatMessage のログ
- Note の各版（編集履歴は任意）
- 質問の質ラベル（✔/△）と内部メタ
- Attachment（画像）と OCR 抽出結果
- 日次メトリクス（チェック数、チャット量、✔数）

---

## 6. UI 構成（最小）

- Home
  - 今日の活動（事実）
  - 日次折線（チェック数/チャット量）
  - 最近触った論点
- Subject/Topic List
  - フィルタ（事実条件）
- Topic Detail
  - チェックON/OFF
  - ノート
  - チャット（論点固定）
  - 履歴（セッション一覧、✔/△の分布）
  - 画像（添付/OCR結果）
- Review（振り返り）
  - 条件抽出（チャット多い論点、未接触論点等）
  - 日次推移（2軸）

---

## 7. 成功条件（アプリ内で観測できる事実）
- 論点単位の履歴が自然に蓄積する
- 振り返りで「どの論点に苦労したか」を見つけられる
- ノートが「復習の起点」になっている
- チャットが散逸せず、論点に閉じて残る